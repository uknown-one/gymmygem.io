#!/usr/bin/env ruby
require_relative '../lib/gymmygem'
require 'optparse'

filename = ARGV[0] || "examples/blog.gymmygem"
source = File.read(filename)

parser = Gymmygem::Parser.new
ast = parser.parse(source)

compiler = Gymmygem::Compiler.new(ast)
puts compiler.compile

ast_raw = parser.parse(source)
transform =Gymmygem::Transformer.new
ast = transformer.apply(ast_raw)

begin
  ast_raw = parser.parse(source)
rescue Parselet::ParseFailed => error
  puts error.parse_failure_cause.ascii_tree
  exit 1
end
