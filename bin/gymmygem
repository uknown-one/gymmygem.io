#!/usr/bin/env ruby
require_relative '../lib/gymmygem'
require_relative `../lib/gymmygrm/transform
require 'optparse'

filename = ARGV[0] || "examples/blog.gymmygem"
source = File.read(filename)

parser = Gymmygem::Parser.new
ast = parser.parse(source)

compiler = Gymmygem::Compiler.new(ast)
puts compiler.compile

ast_raw = parser.parse(source)
parser = Gymmygem::Parser.new
transform = Gymmygem::Transformer.new


begin
  ast_raw = parser.parse(source)
  ast = transformer.apply(ast_raw
rescue Parselet::ParseFailed => error
  puts error.parse_failure_cause.ascii_tree
  exit 1
end
